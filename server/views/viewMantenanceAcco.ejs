<% include partials/header %>
	<!-- BEGIN PAGE -->
	<div class="page-content">
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<h3>Mantenimiento de cuentas contables</h3>
					</div>
				</div>

				<div class="row-fluid">
						<div class="span12">
							<!-- BEGIN EXAMPLE TABLE PORTLET-->
							<div class="portlet box light-grey">
								<div class="portlet-title">
									
								</div>
								<div class="portlet-body">									
                                    <form id="accountingAccount" name="accountingAccount" action="#">
                                        <input type="hidden" name="aacCodeToSave" id="aacCodeToSave" value="">
                                        <input type="hidden" name="aacNivelBefore" id="aacNivelBefore" value="">
                                        <input type="hidden" name="levelToSave" id="levelToSave" value="1">                                        
                                        <div class="row-fluid">
                                            <div class="control-group span5 ">
                                                <div class="row-fluid">
                                                    <div class="control-group span12 ">
                                                        <label for="accCode">
                                                            Empresa
                                                        </label>
                                                        <div class="controls">
                                                            <% if(business.length == 0) { %>   
                                                                No hay empresas disponibles
                                                            <%} else {%>
                                                            <select id="busId" name="busId" class="span5" tabindex=1>   
                                                                <% for(var j = 0; j < business.length; j++) { %>   
                                                                    <option value="<%=business[j].busId%>"> <%=business[j].busName%></option>
                                                                <% }%>
                                                            </select>
                                                            <% }%>
                                                        </div>
                                                    </div>                                            
                                                </div>
                                                <div class="row-fluid">
                                                    <div class="control-group span6 ">
                                                        <input type="hidden" value="" name="accId" id="accId">
                                                        <label for="accCode">
                                                            Catálogo contable
                                                        </label>
                                                        <div class="controls" id="accIdName">                                                    
                                                        </div>
                                                    </div>	
                                                    <div class="control-group span6 ">
                                                        <label for="accCode">
                                                            Tipo de catálogo
                                                        </label>
                                                        <div class="controls" id="accIsGlobal">                                                    
                                                        </div>
                                                    </div>						
                                                </div>
                                                <div class="row-fluid">
                                                    <div class="control-group span6 ">
                                                        <label for="accCode">
                                                            Tipo de ingreso
                                                        </label>
                                                        <div class="controls" > 
                                                            <select id="aacDirection" name="aacDirection" class="span10" tabindex=2>    
                                                                <option value="1">Horizontal</option>                                                    
                                                                <option value="2">Vertical</option>                                                        
                                                            </select>                                                       
                                                        </div>                                              
                                                    </div>
                                                </div>
                                                <div class="row-fluid" id="horizontal1">
                                                    <div class="control-group span12 ">
                                                        <label for="accCode">
                                                            Codigo de cuenta
                                                        </label>
                                                        <div class="controls"> 
                                                            <input type="text" name="aacCode" id="aacCode" class="span11" />                                                
                                                        </div>
                                                    </div>	
                                                </div>
                                                <div class="row-fluid" id="horizontal2">
                                                    <div class="control-group span12 ">
                                                        <label for="accCode">
                                                            Nombre de la cuenta
                                                        </label>
                                                        <div class="controls" >  
                                                            <input type="text" name="aacName" id="aacName" class="span11" />                                                  
                                                        </div>
                                                    </div>
                                                    <div class="control-group span4 ">
                                                    </div>							
                                                </div>
                                                <div class="row-fluid" id="vertical1">
                                                    <div class="control-group span7  ">
                                                    
                                                    </div>
                                                    <div class="control-group span4 ">
                                                        <label  >
                                                            Nombre de la cuenta
                                                        </label>
                                                    </div>							
                                                </div>
                                                <div class="row-fluid" id="vertical2">
                                                    <div class="control-group span5 ">
                                                        <label class="span12 labelTextNivel" style="padding-left: 13px;" id="labelTextNivel1">
                                                            Nivel 1
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel2">
                                                            Nivel 2
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel3">
                                                            Nivel 3
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel4">
                                                            Nivel 4
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel5">
                                                            Nivel 5
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel6">
                                                            Nivel 6
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel7">
                                                            Nivel 7
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel8">
                                                            Nivel 8
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel9">
                                                            Nivel 9
                                                        </label>	
                                                        <label class="span12 labelTextNivel" id="labelTextNivel10">
                                                            Nivel 10
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel11">
                                                            Nivel 11
                                                        </label>
                                                        <label class="span12 labelTextNivel" id="labelTextNivel12">
                                                            Nivel 12
                                                        </label>
                                                    </div>
                                                    <div class="control-group span2 ">
                                                        <input type="text" name="accNivel1" id="accNivel1" class="m-wrap span12" placeholder="Dígitos" tabindex=3 position=1>										
                                                        <input type="text" name="accNivel2" id="accNivel2" class="m-wrap span12" placeholder="Dígitos" tabindex=5 position=2>
                                                        <input type="text" name="accNivel3" id="accNivel3" class="m-wrap span12" placeholder="Dígitos" tabindex=7 position=3>										
                                                        <input type="text" name="accNivel4" id="accNivel4" class="m-wrap span12" placeholder="Dígitos" tabindex=9 position=4>
                                                        <input type="text" name="accNivel5" id="accNivel5" class="m-wrap span12" placeholder="Dígitos" tabindex=11 position=5>										
                                                        <input type="text" name="accNivel6" id="accNivel6" class="m-wrap span12" placeholder="Dígitos" tabindex=13 position=6>
                                                        <input type="text" name="accNivel7" id="accNivel7" class="m-wrap span12" placeholder="Dígitos" tabindex=15 position=7>										
                                                        <input type="text" name="accNivel8" id="accNivel8" class="m-wrap span12" placeholder="Dígitos" tabindex=17 position=8>
                                                        <input type="text" name="accNivel9" id="accNivel9" class="m-wrap span12" placeholder="Dígitos" tabindex=19 position=9>										
                                                        <input type="text" name="accNivel10" id="accNivel10" class="m-wrap span12" placeholder="Dígitos" tabindex=21 position=10>										
                                                        <input type="text" name="accNivel11" id="accNivel11" class="m-wrap span12" placeholder="Dígitos" tabindex=23 position=11>										
                                                        <input type="text" name="accNivel12" id="accNivel12" class="m-wrap span12" placeholder="Dígitos" tabindex=26 position=11>                                            
                                                    </div>
                                                    <div class="control-group span4 ">
                                                        <input type="text" id="accName1" name="accName1" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=4>										
                                                        <input type="text" id="accName2" name="accName2" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=6>
                                                        <input type="text" id="accName3" name="accName3" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=8>										
                                                        <input type="text" id="accName4" name="accName4" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=10>	
                                                        <input type="text" id="accName5" name="accName5" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=12>										
                                                        <input type="text" id="accName6" name="accName6" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=14>	
                                                        <input type="text" id="accName7" name="accName7" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=16>										
                                                        <input type="text" id="accName8" name="accName8" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=18>	
                                                        <input type="text" id="accName9" name="accName9" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=20>										
                                                        <input type="text" id="accName10" name="accName10" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=22>	
                                                        <input type="text" id="accName11" name="accName11" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=24>										
                                                        <input type="text" id="accName12" name="accName12" class="m-wrap span12" placeholder="Nombre nivel" maxlength="30" tabindex=26>											
                                                    </div>								
                                                </div>
                                                <div class="row-fluid">
                                                    <div class="control-group span6 ">
                                                        <label for="accCode">
                                                            Tipo cuenta
                                                        </label>
                                                        <div class="controls" >  
                                                            <select id="aacType" name="aacType" class="span10">
                                                                <option value="1">Activo</option>
                                                                <option value="2">Pasivo</option>
                                                                <option value="3">Patrimonio</option>
                                                                <option value="4">Ingresos</option>
                                                                <option value="5">Costos Ventas</option>
                                                                <option value="6">Gastos</option>
                                                                <option value="7">Costos Producción</option>
                                                            </select>                                               
                                                        </div>
                                                    </div>
                                                    <div class="control-group span6 ">
                                                        <label  >
                                                        Tipo Saldo
                                                        </label>
                                                        <div class="controls" >  
                                                            <select id="aacTypeBalance" name="aacTypeBalance" class="span7">
                                                                <option value="1">Deudor</option>
                                                                <option value="2">Acreedor</option>
                                                            </select>                                                  
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="control-group span6 ">
                                                            <label for="accCode">
                                                                Moneda
                                                            </label>
                                                            <div class="controls" >  
                                                                <select id="aacMoney" name="aacMoney" class="span10">
                                                                    <option value="1">Colón</option>
                                                                    <option value="2">Dolar</option>
                                                                </select>                                               
                                                            </div>
                                                        </div>
                                                        <div class="control-group span4 ">                                                  
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="control-group span11 ">
                                                            <label for="accCode">
                                                                Funcionalidad
                                                            </label>
                                                            <div class="controls" >  
                                                                <textarea id="aacFuncionality" name="aacFuncionality" class="span12">                                                           
                                                                </textarea>                                               
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="control-group span11 ">
                                                            <label for="accCode">
                                                                Observaciones
                                                            </label>
                                                            <div class="controls" >  
                                                                <textarea id="aacObservations" name="aacObservations" class="span12">                                                           
                                                                </textarea>                                               
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="control-group span8 ">                                                    
                                                        </div>
                                                        <div class="control-group span4 ">   
                                                            <button type="button" class="btn green" onclick="fnSaveAccountingAccount()">Guardar</button>                                               
                                                        </div>
                                                    </div>								
                                                </div>
                                            </div>
                                            <div class="control-group span7 " style="height: 420px;">
                                                   <table id="listAsignPermit" class="bt-table" 
                                                        data-side-pagination="server"
                                                        data-pagination="true"
                                                        data-page-size="10"
                                                        data-page-list="[10, 20, 30]"
                                                        data-search="true">
                                                    </table>
                                            </div>
                                        </div>
                                    </form>
									
								</div>
							</div>
							<!-- END EXAMPLE TABLE PORTLET-->
						</div>
					</div>
			</div>
			
	</div>	

<% include partials/footer %>
<script type="text/javascript">
    var jsonData
    var accSeparator
	$(document).ready(function(){
        $('#busId').select2({});
        $('#aacType').select2({});
        $('#aacTypeBalance').select2({});
        $('#aacMoney').select2({});   
        $('#aacDirection').select2({});
        aacDirection()
             
        <% if(business.length != 0) { %>
            fnGetCatalog();	
            setTimeout(function(){ handleTableData(); }, 300);         
        <% }%>
	});
	isFirtsDatatable = true;
	function handleTableData() {
		$('#listAsignPermit').bootstrapTable({
			height: 510,
			method: 'GET',
			url: '/contab/getAccountingAccount/'+$('#accId').val(),
			cache: false,
			columns: [
				{
					field: 'aacCode',
					title: 'Código cuenta',
					sortable: true,
					width: '20%'
				}, {
					field: 'aacName',
					title: 'Nombre',
					sortable: true,
					width: '15%'
				}, {
					field: 'aacType',
					title: 'Tipo cuenta',
					sortable: false,
                    width: '5%',
					formatter: operateFormatter
				}, {
					field: 'aacTypeBalance',
					title: 'Tipo saldo',
					sortable: false,
                    width: '5%',
                    formatter: operateFormatter2
				}
                
			]
		});
	};
	function getHeight() {
		return $(window).height();
    }
    
    function operateFormatter(value, row, index) {
        return [
            ((row.aacType == 1) ? "Activo" : "Pasivo"),
        ].join('');
    }
    function operateFormatter2(value, row, index) {
        return [
            ((row.aacTypeBalance == 1) ? "Deudor" : "Acreedor"),
        ].join('');
    }
    function operateFormatter3(value, row, index) {
        return [
            "<button type='button' class='btn red",
            " btnActiveInactive' onclick='fnEliminar("+ row.bupId +")'>",
            "<i class='icon-off'></i> ",
           "Eliminar",
            "</button>"
        ].join('');
    }

    function refreshTable() {
        $('.bt-table').bootstrapTable('refresh',{url: '/contab/getAccountingAccount/'+$('#accId').val()});
    }

    // opcion 1 
	function fnGetCatalog(){
		$.ajax({
            type: "GET",
			url: "/contab/getCatalog/"+$('#busId').val(),		
            beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
                showIsLoading("Procesando...");
            }
        }).done(function (data) {	
            hideIsLoading();	
            showData(data)
        }).fail(function (data) {
            hideIsLoading();
            fnOpenErrorDialog(data.responseJSON.message);
        }).always(function (data) {
            hideIsLoading();
        });
    }

    function aacDirection(){
        if($('#aacDirection').val() == 1){
            $('#vertical1').hide();
            $('#vertical2').hide();
            $('#horizontal1').show();
            $('#horizontal2').show();
        }
        else{
            $('#vertical1').show();
            $('#vertical2').show();
            $('#horizontal1').hide();
            $('#horizontal2').hide();
        }
    }
    $('#aacDirection').change(function (){        
        aacDirection()
    })
    $('#busId').change(function (){
        $.ajax({
            type: "GET",
			url: "/contab/getCatalog/"+$('#busId').val(),			
            beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
                showIsLoading("Procesando...");
            }
        }).done(function (data) {	
            hideIsLoading();                
            showData(data)
            refreshTable()
        }).fail(function (data) {
            hideIsLoading();
            fnOpenErrorDialog(data.responseJSON.message);
            //deberia inhabilitar todos los campos
        }).always(function (data) {
            hideIsLoading();
        });
    })

    function showData(data){
        $('#accId').val(data.accountCatalog.accId);
        jsonData = JSON.parse(data.accountCatalog.accNivels)
        accQuantityNivels = data.accountCatalog.accQuantityNivels
        accSeparator = data.accountCatalog.accSeparator        
        $('#accIdName').html(data.accountCatalog.accName);
        if(data.accountCatalog.accIsGlobal==1){
            $('#accIsGlobal').html('Global')
        }
        else{
            $('#accIsGlobal').html('Individual')
        }
        console.log('accQuantityNivels',accQuantityNivels)
        for(var a=1;  a<=accQuantityNivels; a++){																	
            $('#accNivel'+a).val('')	
            $('#accName'+a).val('')	
            $('#accNivel'+a).show()
            $('#accName'+a).show()
            $('#labelTextNivel'+a).show()	
            if(a>1){
                $('#accNivel'+a).prop( "disabled", true );
                $('#accName'+a).prop( "disabled", true );
            }	
        }
        if(accQuantityNivels<13){
            newlimit = accQuantityNivels +1;
            for(var a=newlimit;  a<13; a++){																	
                $('#accNivel'+a).hide()
                $('#labelTextNivel'+a).hide()
                $('#accName'+a).hide()			
            }
        }
        $('#labelTextNivel1').html(jsonData.accName1)
        $('#labelTextNivel2').html(jsonData.accName2)
        $('#labelTextNivel3').html(jsonData.accName3)
        $('#labelTextNivel4').html(jsonData.accName4)
        $('#labelTextNivel5').html(jsonData.accName5)
        $('#labelTextNivel6').html(jsonData.accName6)
        $('#labelTextNivel7').html(jsonData.accName7)
        $('#labelTextNivel8').html(jsonData.accName8)
        $('#labelTextNivel9').html(jsonData.accName9)
        $('#labelTextNivel10').html(jsonData.accName10)
        $('#labelTextNivel11').html(jsonData.accName11)
        $('#labelTextNivel12').html(jsonData.accName12)	

        // queda pendiente lo de nombre de la cuenta??? y el length
        //crear la mascara
        dataMask = ''
        for(var a=1;  a<=jsonData.accNivel1; a++){																	
            dataMask = dataMask+'9'		
        }
        if(jsonData.accNivel2){
            dataMask = dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel2; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel3){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel3; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel4){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel4; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel5){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel5; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel6){
            dataMask = dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel6; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel7){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel7; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel8){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel8; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel9){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel9; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel10){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel10; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel11){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel11; a++){																	
                dataMask = dataMask+'9'		
            }
        }
        if(jsonData.accNivel12){
            dataMask=dataMask+accSeparator
            for(var a=1;  a<=jsonData.accNivel12; a++){																	
                dataMask = dataMask+'9'		
            }
        }

        
        $("#aacCode").inputmask("mask", {"mask": dataMask, "clearIncomplete": false ,'removeMaskOnSubmit': true, 'autoUnmask': true,});
        // el length
        $("#accNivel1").attr('maxlength',jsonData.accNivel1);
        $("#accNivel2").attr('maxlength',jsonData.accNivel2);
        $("#accNivel3").attr('maxlength',jsonData.accNivel3);
        $("#accNivel4").attr('maxlength',jsonData.accNivel4);
        $("#accNivel5").attr('maxlength',jsonData.accNivel5);
        $("#accNivel6").attr('maxlength',jsonData.accNivel6);
        $("#accNivel7").attr('maxlength',jsonData.accNivel7);
        $("#accNivel8").attr('maxlength',jsonData.accNivel8);
        $("#accNivel9").attr('maxlength',jsonData.accNivel9);
        $("#accNivel10").attr('maxlength',jsonData.accNivel10);
        $("#accNivel11").attr('maxlength',jsonData.accNivel11);
        $("#accNivel12").attr('maxlength',jsonData.accNivel12);
    }

    //validar el maxlenth y la mascara al guardar
    function fnSaveAccountingAccount(){
        // is valid

        // puedo guardar
        nivel2= jsonData.accNivel1*1+jsonData.accNivel2*1
        nivel3= nivel2+jsonData.accNivel3*1
        nivel4= nivel3+jsonData.accNivel4*1
        nivel5= nivel4+jsonData.accNivel5*1
        nivel6= nivel5+jsonData.accNivel6*1
        nivel7= nivel6+jsonData.accNivel7*1
        nivel8= nivel7+jsonData.accNivel8*1
        nivel9= nivel8+jsonData.accNivel9*1
        nivel10= nivel9+jsonData.accNivel10*1
        nivel11= nivel10+jsonData.accNivel11*1
        nivel12= nivel11+jsonData.accNivel12*1
        newAccount = $('#aacCode').val();

        if(newAccount.length==jsonData.accNivel1*1 || newAccount.length== nivel2 || newAccount.length==nivel3 || newAccount.length==nivel4 || newAccount.length==nivel5 || 
            newAccount.length== nivel6 || newAccount.length==nivel7 || newAccount.length==nivel8 || newAccount.length==nivel9 || newAccount.length== nivel10 || newAccount.length==nivel11 || newAccount.length==nivel12){
            $('#aacCodeToSave').val(putMask(newAccount))
            if($('#aacDirection').val()==2){
                $('#aacName').val($('#accName'+$('#levelToSave').val()).val())
            }

            if(($('#aacName').val()==''&&$('#aacDirection').val()==1) || ($('#accName'+$('#levelToSave').val()).val()==''&&$('#aacDirection').val()==2) ){
                fnOpenErrorDialog("El nombre de la cuenta es requerido");
            }
            else{
                $.ajax({
                    type: "POST",
                    url: "/contab/saveAccountingAccount",
                    data: $('#accountingAccount').serialize(), //se envia el form serializado          
                    beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
                        showIsLoading("Procesando...");
                    }
                }).done(function (data) {  
                    fnOpenSusessDialog(data.message)          
                    hideIsLoading();   
                    clean()                      
                    setTimeout(function(){ refreshTable(); }, 300);                    
                }).fail(function (data) {
                    hideIsLoading();
                    fnOpenErrorDialog(data.responseJSON.message);
                })
            }
                

        }
        else{
            fnOpenErrorDialog("Debe digitar un código de cuenta válida");
        }
    }

    $( "#aacCode" ).on( "keydown", function(event) {
        if(event.which == 13){
            fnSearch($('#aacCode').val())
        }         
    });
    
    $('#aacCode').change(function (){
        fnSearch($('#aacCode').val())
    })

    function fnSearch(){
        console.log($('#aacCode').val())
        newAccount = $('#aacCode').val();
        search =false;
        //si es solo el primer nivel hago searh
        if(newAccount.length==jsonData.accNivel1){
            search =true;
        }
        nivel2= jsonData.accNivel1*1+jsonData.accNivel2*1
        nivel3= nivel2+jsonData.accNivel3*1
        nivel4= nivel3+jsonData.accNivel4*1
        nivel5= nivel4+jsonData.accNivel5*1
        nivel6= nivel5+jsonData.accNivel6*1
        nivel7= nivel6+jsonData.accNivel7*1
        nivel8= nivel7+jsonData.accNivel8*1
        nivel9= nivel8+jsonData.accNivel9*1
        nivel10= nivel9+jsonData.accNivel10*1
        nivel11= nivel10+jsonData.accNivel11*1
        nivel12= nivel11+jsonData.accNivel12*1
        if( newAccount.length== nivel2 || newAccount.length==nivel3 || newAccount.length==nivel4 || newAccount.length==nivel5 || 
            newAccount.length== nivel6 || newAccount.length==nivel7 || newAccount.length==nivel8 || newAccount.length==nivel9 || newAccount.length== nivel10 || newAccount.length==nivel11 || newAccount.length==nivel12){
            newAccount=putMask(newAccount)
            search =true;            
        }
        if(search){
            //obtener el nombre del nivel si existe
            $.ajax({
                type: "GET",
                url: "/contab/getAccountingAccountSearch/"+$('#accId').val()+"?aacCode="+newAccount,       
                beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
                    showIsLoading("Procesando...");
                }
            }).done(function (data) {  
                console.log(data)
                if(data.accountingAccount!=null){
                    $('#aacName').val(data.accountingAccount.aacName);
                }
                else{
                    $('#aacName').val('');
                }

                hideIsLoading();                                         
            }).fail(function (data) {
                hideIsLoading();
                fnOpenErrorDialog(data.responseJSON.message);
            })
        }
    }

    function putMask(dataMask){
        newDataWithMask =''
        nivel2= jsonData.accNivel1*1+jsonData.accNivel2*1
        nivel3= nivel2+jsonData.accNivel3*1
        nivel4= nivel3+jsonData.accNivel4*1
        nivel5= nivel4+jsonData.accNivel5*1
        nivel6= nivel5+jsonData.accNivel6*1
        nivel7= nivel6+jsonData.accNivel7*1
        nivel8= nivel7+jsonData.accNivel8*1
        nivel9= nivel8+jsonData.accNivel9*1
        nivel10= nivel9+jsonData.accNivel10*1
        nivel11= nivel10+jsonData.accNivel11*1
        nivel12= nivel11+jsonData.accNivel12*1
        for(var a=0;  a<dataMask.length; a++){	
            if(jsonData.accNivel1==a||nivel2==a||nivel3==a||nivel4==a||nivel5==a||nivel6==a||nivel7==a||nivel8==a||nivel9==a||nivel10==a||nivel11==a||nivel12==a){
                $('#aacNivelBefore').val(newDataWithMask)
                newDataWithMask = newDataWithMask+accSeparator
            }	            															
            newDataWithMask = newDataWithMask+dataMask.charAt(a)		
        }   
        // debo buscar el primer nivel para el manejo de tipo de cuenta y saldo y bloquear tipo de cuenta

        return newDataWithMask
    }

    function clean(){
        $('#aacCodeToSave').val('')
        $('#aacNivelBefore').val('')
        $('#aacNivelBefore').val('')
        $('#aacName').val('')
        $('#aacCode').val('')
        $('#aacObservations').val('')
        $('#aacObservations').val('')

        for(var a=1;  a<13; a++){																	
            $('#accNivel'+a).val('')
            $('#accName'+a).val('')	
            if(a>1){
                $('#accNivel'+a).prop( "disabled", true );
                $('#accName'+a).prop( "disabled", true );  
            }    		
        }  
        
    }
    ////// vertical
    function fnSearchVertical(data, level){
        level=level*1
        dataToSearch = $('#accNivel1').val()
        search = false;
        for(var a=2;  a<=level; a++){
            //invalido para guardar o buscar	
            if($('#accNivel'+a).val()==''){
                return search;
            }																
            dataToSearch=dataToSearch+$('#accNivel'+a).val()        
        }   
        $('#aacCode').val(dataToSearch)
        dataToSearch =putMask(dataToSearch)
        $('#aacCodeToSave').val(dataToSearch)
        console.log(dataToSearch)
        //acordame de llenar los otros
        search =true;
        if(search){
            //obtener el nombre del nivel si existe
            $.ajax({
                type: "GET",
                url: "/contab/getAccountingAccountSearch/"+$('#accId').val()+"?aacCode="+dataToSearch,      
                beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
                    showIsLoading("Procesando...");
                }
            }).done(function (data) {  
                
                if(data.accountingAccount!=null){
                    $('#accName'+level).val(data.accountingAccount.aacName)	    
                    //enable next level
                    level=level+1
                    $('#levelToSave').val(level)
                    $('#accNivel'+level).prop( "disabled", false );
                    $('#accName'+level).prop( "disabled", false );               
                }
                else{
                    $('#levelToSave').val(level)
                    $('#accName'+level).val('')
                    for(var a=level+1;  a<13; a++){																	
                        $('#accNivel'+a).val('')
                        $('#accName'+a).val('')	
                        $('#accNivel'+a).prop( "disabled", true );
                        $('#accName'+a).prop( "disabled", true );      		
                    }                    
                }

                hideIsLoading();                                         
            }).fail(function (data) {
                hideIsLoading();
                fnOpenErrorDialog(data.responseJSON.message);
            })
        }
    }

    for(var aIndex=1;  aIndex<13; aIndex++){	
        $( "#accNivel"+aIndex ).on( "keydown", function(event) {
            if(event.which == 13||event.which == 9){
                if($(this).attr('maxlength') == $(this).val().length){
                    fnSearchVertical($(this).val(), $(this).attr('position'))
                }                
            }         
        });
        
        $('#accNivel'+aIndex).change(function (aIndex){
            if($(this).attr('maxlength') == $(this).val().length)
                fnSearchVertical($(this).val(), $(this).attr('position'))
        })
    }
</script>